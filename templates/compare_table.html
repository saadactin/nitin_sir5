<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Table Comparison - {{ server }}.{{ db }}.{{ table }}</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: { DEFAULT: "#1E40AF", hover: "#1D4ED8" },
            success: "#198754",
            successDark: "#157347",
            info: "#0DCAF0",
            warning: "#FFC107",
            danger: "#DC3545",
            "background-light": "#F8FAFC",
            "background-dark": "#0F172A",
            "surface-light": "#FFFFFF",
            "surface-dark": "#1E293B",
            "text-light": "#0F172A",
            "text-dark": "#E2E8F0",
            "subtext-light": "#64748B",
            "subtext-dark": "#94A3B8",
            "border-light": "#E2E8F0",
            "border-dark": "#334155",
          },
          fontFamily: { display: ["Inter", "sans-serif"] },
          borderRadius: { DEFAULT: "0.5rem" }
        }
      }
    };
  </script>
  <style>
    .material-icons { font-size: 20px; vertical-align: middle; }
    .missing-row { background-color: #f8d7da; }
    .extra-row { background-color: #d1ecf1; }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
  <div class="flex h-screen">
    <!-- Sidebar -->
    {% include 'sidebar.html' %}

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto ml-64 p-8">
      <div class="max-w-6xl mx-auto space-y-6">
        <!-- Header -->
        <div class="flex justify-between items-center">
          <h1 class="text-3xl font-bold flex items-center gap-2"><span class="material-icons">search</span> Table Comparison</h1>
          <a href="{{ url_for('index') }}" class="flex items-center gap-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
            <span class="material-icons">arrow_back</span> Back to Home
          </a>
        </div>

        <!-- Table Info -->
        <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow border border-border-light dark:border-border-dark p-4 grid grid-cols-1 md:grid-cols-4 gap-4">
          <div><strong>Server:</strong> {{ server }}</div>
          <div><strong>Database:</strong> {{ db }}</div>
          <div><strong>Table:</strong> {{ table }}</div>
          <div><strong>Last Check:</strong> {{ delta_info.last_check }}</div>
        </div>

        <!-- Summary Stats -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
          <div class="bg-primary text-white rounded-lg p-4 text-center">
            <h4 class="text-2xl font-semibold">{{ comparison.rows_source }}</h4>
            <p>Source Rows</p>
          </div>
          <div class="bg-success text-white rounded-lg p-4 text-center">
            <h4 class="text-2xl font-semibold">{{ comparison.rows_destination }}</h4>
            <p>Destination Rows</p>
          </div>
          <div class="bg-danger text-white rounded-lg p-4 text-center">
            <h4 class="text-2xl font-semibold">{{ comparison.missing_rows|length }}</h4>
            <p>Missing Rows</p>
          </div>
          <div class="bg-warning text-dark rounded-lg p-4 text-center">
            <h4 class="text-2xl font-semibold">{{ comparison.extra_rows|length }}</h4>
            <p>Extra Rows</p>
          </div>
        </div>

        <!-- Delta Information -->
        <div class="bg-warning text-dark rounded-lg shadow border border-border-light dark:border-border-dark p-4 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div><strong>Delta Count:</strong> {{ delta_info.delta_count }}</div>
          <div><strong>Total Source:</strong> {{ delta_info.total_source_rows }}</div>
          <div><strong>Total Destination:</strong> {{ delta_info.total_destination_rows }}</div>
        </div>

        <!-- Missing Rows -->
        {% if comparison.missing_rows|length > 0 %}
        <div class="bg-danger text-white rounded-lg shadow border border-border-light dark:border-border-dark overflow-x-auto">
          <div class="p-4">
            <h2 class="text-lg font-semibold mb-2">‚ùå Missing Rows ({{ comparison.missing_rows|length }})</h2>
            <p class="mb-2 text-sm">Rows present in source but not in destination</p>
            <table class="min-w-full table-auto border-collapse border border-border-light dark:border-border-dark">
              <thead class="bg-red-700 text-white">
                <tr>
                  {% for col in comparison.missing_rows.columns %}
                  <th class="px-2 py-1 border">{{ col }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for _, row in comparison.missing_rows.iterrows() %}
                <tr class="missing-row">
                  {% for col in comparison.missing_rows.columns %}
                  <td class="px-2 py-1 border">{{ row[col] }}</td>
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        {% endif %}

        <!-- Extra Rows -->
        {% if comparison.extra_rows|length > 0 %}
        <div class="bg-warning text-dark rounded-lg shadow border border-border-light dark:border-border-dark overflow-x-auto">
          <div class="p-4">
            <h2 class="text-lg font-semibold mb-2">‚ûï Extra Rows ({{ comparison.extra_rows|length }})</h2>
            <p class="mb-2 text-sm">Rows present in destination but not in source</p>
            <table class="min-w-full table-auto border-collapse border border-border-light dark:border-border-dark">
              <thead class="bg-yellow-500 text-dark">
                <tr>
                  {% for col in comparison.extra_rows.columns %}
                  <th class="px-2 py-1 border">{{ col }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for _, row in comparison.extra_rows.iterrows() %}
                <tr class="extra-row">
                  {% for col in comparison.extra_rows.columns %}
                  <td class="px-2 py-1 border">{{ row[col] }}</td>
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        {% endif %}

        <!-- Source Sample -->
        {% if comparison.source_data|length > 0 %}
        <div class="bg-primary text-white rounded-lg shadow border border-border-light dark:border-border-dark overflow-x-auto">
          <div class="p-4">
            <h2 class="text-lg font-semibold mb-2">üì• Source Data Sample</h2>
            <p class="mb-2 text-sm">First 10 rows from source</p>
            <table class="min-w-full table-auto border-collapse border border-border-light dark:border-border-dark">
              <thead class="bg-blue-700 text-white">
                <tr>
                  {% for col in comparison.source_data.columns %}
                  <th class="px-2 py-1 border">{{ col }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for _, row in comparison.source_data.head(10).iterrows() %}
                <tr>
                  {% for col in comparison.source_data.columns %}
                  <td class="px-2 py-1 border">{{ row[col] }}</td>
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        {% endif %}

        <!-- Destination Sample -->
        {% if comparison.destination_data|length > 0 %}
        <div class="bg-success text-white rounded-lg shadow border border-border-light dark:border-border-dark overflow-x-auto">
          <div class="p-4">
            <h2 class="text-lg font-semibold mb-2">üì§ Destination Data Sample</h2>
            <p class="mb-2 text-sm">First 10 rows from destination</p>
            <table class="min-w-full table-auto border-collapse border border-border-light dark:border-border-dark">
              <thead class="bg-green-700 text-white">
                <tr>
                  {% for col in comparison.destination_data.columns %}
                  <th class="px-2 py-1 border">{{ col }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for _, row in comparison.destination_data.head(10).iterrows() %}
                <tr>
                  {% for col in comparison.destination_data.columns %}
                  <td class="px-2 py-1 border">{{ row[col] }}</td>
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        {% endif %}

        {% if comparison.missing_rows|length == 0 and comparison.extra_rows|length == 0 %}
        <div class="bg-success text-white rounded-lg p-4 text-center">
          <h2 class="text-lg font-semibold">‚úÖ Tables are in sync!</h2>
          <p>No missing or extra rows found. Source and destination tables have identical data.</p>
        </div>
        {% endif %}

      </div>
    </main>
  </div>
</body>
</html>
