<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sync Summary - Row Count Comparison</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: { DEFAULT: "#1E40AF", hover: "#1D4ED8" },
            info: "#0D6EFD",
            "background-light": "#F8FAFC",
            "background-dark": "#0F172A",
            "surface-light": "#FFFFFF",
            "surface-dark": "#1E293B",
            "text-light": "#0F172A",
            "text-dark": "#E2E8F0",
            "subtext-light": "#64748B",
            "subtext-dark": "#94A3B8",
            "border-light": "#E2E8F0",
            "border-dark": "#334155",
            "success": "#198754",
            "success-dark": "#157347",
            "warning": "#ffc107",
            "warning-dark": "#e0a800"
          },
          fontFamily: { display: ["Inter", "sans-serif"] },
          borderRadius: { DEFAULT: "0.5rem" }
        },
      },
    };
  </script>
  <style>
    .material-icons { font-size: 20px; vertical-align: middle; }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
  <div class="flex h-screen">
    <!-- Sidebar -->
    {% include 'sidebar.html' %}

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto ml-64 p-8">
      <div class="container mx-auto">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
          <h1 class="text-3xl font-bold flex items-center gap-2">
            <span class="material-icons">compare</span> 
            Sync Summary - Server Comparisons
          </h1>
          <div class="flex gap-2">
            <button onclick="location.reload()" 
                    class="px-4 py-2 rounded-md bg-primary hover:bg-primary-hover text-white transition flex items-center gap-2">
              <span class="material-icons text-sm">refresh</span>
              Refresh
            </button>
            <a href="{{ url_for('index') }}"
               class="px-4 py-2 rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                ← Back to Home
            </a>
          </div>
        </div>

        <p class="text-subtext-light dark:text-subtext-dark mb-8">
          Individual server-to-PostgreSQL database comparisons. Click on a card for detailed breakdown.
        </p>

        <!-- Individual Server Comparison Cards -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {% for server in servers %}
            <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow-lg border border-border-light dark:border-border-dark overflow-hidden hover:shadow-xl transition-shadow cursor-pointer"
                 onclick="window.location.href='{{ url_for('sync_summary_detail', server_name=server.server_name) }}'">
              
              <!-- Server Header -->
              <div class="p-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white">
                <div class="flex items-center justify-between">
                  <div>
                    <h3 class="text-xl font-bold">{{ server.server_name }}</h3>
                    <p class="text-blue-100 text-sm">{{ server.sql_server.host }}:{{ server.sql_server.port }}</p>
                  </div>
                  <div class="text-right">
                    <div class="text-2xl font-bold">{{ "{:,}".format(server.comparison.sync_percentage) }}%</div>
                    <div class="text-xs text-blue-100">Sync Status</div>
                  </div>
                </div>
              </div>

              <!-- Comparison Metrics -->
              <div class="p-6">
                <div class="grid grid-cols-2 gap-4 mb-4">
                  <!-- SQL Server Section -->
                  <div class="text-center">
                    <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">SQL Server</div>
                    <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">
                      {{ "{:,}".format(server.comparison.sql_total_rows) }}
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">
                      {{ server.sql_server.database_count }} database(s)
                    </div>
                  </div>

                  <!-- PostgreSQL Section -->
                  <div class="text-center">
                    <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">PostgreSQL</div>
                    <div class="text-2xl font-bold text-green-600 dark:text-green-400">
                      {{ "{:,}".format(server.comparison.postgres_total_rows) }}
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">
                      {{ server.postgresql.database }}
                    </div>
                  </div>
                </div>

                <!-- Target Database Mapping -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-3 mb-4">
                  <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Target Mapping</div>
                  <div class="flex items-center justify-between text-sm">
                    <span class="font-medium">{{ server.sql_server.host }}</span>
                    <span class="material-icons text-gray-400">arrow_forward</span>
                    <span class="font-medium text-green-600 dark:text-green-400">{{ server.sql_server.target_postgres_db }}</span>
                  </div>
                </div>

                <!-- Status Badge -->
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    {% if server.comparison.status == 'Complete' %}
                      <span class="px-2 py-1 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded-full text-xs font-medium">
                        ✓ {{ server.comparison.status }}
                      </span>
                    {% else %}
                      <span class="px-2 py-1 bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 rounded-full text-xs font-medium">
                        ⚠ {{ server.comparison.status }}
                      </span>
                    {% endif %}
                  </div>
                  
                  <div class="text-right">
                    <div class="text-xs text-gray-500 dark:text-gray-400">Difference</div>
                    <div class="text-sm font-bold {% if server.comparison.difference >= 0 %}text-green-600 dark:text-green-400{% else %}text-red-600 dark:text-red-400{% endif %}">
                      {% if server.comparison.difference >= 0 %}+{% endif %}{{ "{:,}".format(server.comparison.difference) }}
                    </div>
                  </div>
                </div>

                <!-- Click hint -->
                <div class="mt-4 pt-3 border-t border-gray-200 dark:border-gray-700">
                  <div class="text-center text-xs text-gray-500 dark:text-gray-400 flex items-center justify-center gap-1">
                    <span class="material-icons text-xs">visibility</span>
                    Click for detailed breakdown
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        {% if not servers %}
          <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow border border-border-light dark:border-border-dark p-8 text-center">
            <span class="material-icons text-4xl text-gray-400 mb-4">storage_off</span>
            <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-2">No SQL Servers Configured</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Add SQL Server connections to start comparing data.</p>
            <a href="{{ url_for('add_server') }}" 
               class="px-4 py-2 bg-primary hover:bg-primary-hover text-white rounded-lg transition inline-flex items-center gap-2">
              <span class="material-icons text-sm">add</span>
              Add SQL Server
            </a>
          </div>
        {% endif %}
      </div>
    </main>
  </div>
</body>
</html>
