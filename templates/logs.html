<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Log Analysis Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
<script>
tailwind.config = {
  darkMode: "class",
  theme: {
    extend: {
      colors: {
        primary: { DEFAULT: "#1E40AF", hover: "#1D4ED8" },
        "background-light": "#F8FAFC",
        "background-dark": "#0F172A",
        "surface-light": "#FFFFFF",
        "surface-dark": "#1E293B",
        "text-light": "#0F172A",
        "text-dark": "#E2E8F0",
        "subtext-light": "#64748B",
        "subtext-dark": "#94A3B8",
        "border-light": "#E2E8F0",
        "border-dark": "#334155",
        "success": "#198754",
        "success-dark": "#157347",
        "warning": "#f39c12",
        "error": "#e74c3c",
        "info": "#3498db"
      },
      fontFamily: { display: ["Inter", "sans-serif"] },
      borderRadius: { DEFAULT: "0.5rem" }
    }
  }
};
</script>
<style>
.material-icons { font-size: 20px; vertical-align: middle; }
.level-badge { font-weight: bold; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-size: 0.8rem; }
.level-error { background-color: #fee2e2; color: #b91c1c; }
.level-warning { background-color: #fff7e0; color: #b45309; }
.level-info { background-color: #e0f2fe; color: #0369a1; }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
<div class="flex h-screen">
  <!-- Sidebar -->
  {% include 'sidebar.html' %}

  <!-- Main Content -->
  <main class="flex-1 overflow-y-auto ml-64 p-8">
    <div class="max-w-7xl mx-auto">

      <!-- Header -->
      <div class="mb-6">
        <h1 class="text-2xl font-bold flex items-center gap-2">
          <span class="material-icons text-success">analytics</span>
          Log Analysis Dashboard
        </h1>
        <p class="text-subtext-light dark:text-subtext-dark">Monitor and analyze PostgreSQL sync logs</p>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-wrap gap-4 mb-6">
        
        <a href="/logs/download" class="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-hover transition">
          <span class="material-icons">download</span> Download Logs
        </a>
     
      </div>

      <!-- Summary Cards -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow p-4">
          <h3 class="text-lg font-semibold">Total Entries</h3>
          <p class="text-2xl font-bold mt-2">{{ alerts_total + warnings_total + infos_total }}</p>
        </div>
        <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow p-4">
          <h3 class="text-lg font-semibold">Alerts / Errors</h3>
          <p class="text-2xl font-bold mt-2 text-error">{{ alerts_total }}</p>
        </div>
        <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow p-4">
          <h3 class="text-lg font-semibold">Warnings</h3>
          <p class="text-2xl font-bold mt-2 text-warning">{{ warnings_total }}</p>
        </div>
        <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow p-4">
          <h3 class="text-lg font-semibold">Info Messages</h3>
          <p class="text-2xl font-bold mt-2 text-info">{{ infos_total }}</p>
        </div>
      </div>

      {% if not log_exists %}
      <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow p-6 text-center">
        <span class="material-icons text-6xl text-subtext-light mb-4">find_in_page</span>
        <h2 class="text-xl font-semibold mb-2">Log File Not Found</h2>
        <p class="text-subtext-light dark:text-subtext-dark">The log file 'load_postgres.log' could not be found.</p>
      </div>
      {% else %}

      <!-- Alerts Section -->
      <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow p-4 mb-6">
        <div class="bg-error text-white p-4 flex items-center gap-2">
          <span class="material-icons">error</span>
          <h2 class="text-lg font-semibold">Alerts & Errors ({{ alerts_total }})</h2>
        </div>
        <div class="divide-y divide-border-light dark:divide-border-dark">
          {% for entry in alerts %}
          <div class="p-4 hover:bg-background-light dark:hover:bg-background-dark">
            <div class="flex justify-between items-start mb-2">
              <span class="level-badge level-error">{{ entry.level }}</span>
              <span class="text-sm text-subtext-light">{{ entry.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</span>
            </div>
            <p class="text-sm">{{ entry.message }}</p>
          </div>
          {% endfor %}
        </div>
        {% if alerts_total > per_page %}
        <div class="flex justify-between p-4">
          {% if errors_page > 1 %}
          <a href="{{ url_for('view_logs', errors_page=errors_page-1) }}" class="px-3 py-1 bg-gray-200 rounded">Prev</a>
          {% endif %}
          {% if errors_page * per_page < alerts_total %}
          <a href="{{ url_for('view_logs', errors_page=errors_page+1) }}" class="px-3 py-1 bg-gray-200 rounded">Next</a>
          {% endif %}
        </div>
        {% endif %}
      </div>

      <!-- Warnings Section -->
      <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow p-4 mb-6">
        <div class="bg-warning text-white p-4 flex items-center gap-2">
          <span class="material-icons">warning</span>
          <h2 class="text-lg font-semibold">Warnings ({{ warnings_total }})</h2>
        </div>
        <div class="divide-y divide-border-light dark:divide-border-dark">
          {% for entry in warnings %}
          <div class="p-4 hover:bg-background-light dark:hover:bg-background-dark">
            <div class="flex justify-between items-start mb-2">
              <span class="level-badge level-warning">{{ entry.level }}</span>
              <span class="text-sm text-subtext-light">{{ entry.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</span>
            </div>
            <p class="text-sm">{{ entry.message }}</p>
          </div>
          {% endfor %}
        </div>
        {% if warnings_total > per_page %}
        <div class="flex justify-between p-4">
          {% if warnings_page > 1 %}
          <a href="{{ url_for('view_logs', warnings_page=warnings_page-1) }}" class="px-3 py-1 bg-gray-200 rounded">Prev</a>
          {% endif %}
          {% if warnings_page * per_page < warnings_total %}
          <a href="{{ url_for('view_logs', warnings_page=warnings_page+1) }}" class="px-3 py-1 bg-gray-200 rounded">Next</a>
          {% endif %}
        </div>
        {% endif %}
      </div>

      <!-- Info Section -->
      <div class="bg-surface-light dark:bg-surface-dark rounded-lg shadow p-4 mb-6">
        <div class="bg-info text-white p-4 flex items-center gap-2">
          <span class="material-icons">info</span>
          <h2 class="text-lg font-semibold">Info Messages ({{ infos_total }})</h2>
        </div>
        <div class="divide-y divide-border-light dark:divide-border-dark">
          {% for entry in infos %}
          <div class="p-4 hover:bg-background-light dark:hover:bg-background-dark">
            <div class="flex justify-between items-start mb-2">
              <span class="level-badge level-info">{{ entry.level }}</span>
              <span class="text-sm text-subtext-light">{{ entry.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</span>
            </div>
            <p class="text-sm">{{ entry.message }}</p>
          </div>
          {% endfor %}
        </div>
        {% if infos_total > per_page %}
        <div class="flex justify-between p-4">
          {% if info_page > 1 %}
          <a href="{{ url_for('view_logs', info_page=info_page-1) }}" class="px-3 py-1 bg-gray-200 rounded">Prev</a>
          {% endif %}
          {% if info_page * per_page < infos_total %}
          <a href="{{ url_for('view_logs', info_page=info_page+1) }}" class="px-3 py-1 bg-gray-200 rounded">Next</a>
          {% endif %}
        </div>
        {% endif %}
      </div>

      {% endif %}
    </div>
  </main>
</div>

<script>
document.getElementById('theme-toggle').addEventListener('click', function() {
  if (document.documentElement.classList.contains('dark')) {
    document.documentElement.classList.remove('dark');
    localStorage.setItem('theme', 'light');
  } else {
    document.documentElement.classList.add('dark');
    localStorage.setItem('theme', 'dark');
  }
});
if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
  document.documentElement.classList.add('dark');
} else {
  document.documentElement.classList.remove('dark');
}
</script>
</body>
</html>
